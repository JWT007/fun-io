before_cache:
  - find $HOME/.ivy2 -name "ivydata-*.properties" | xargs rm
  - find $HOME/.sbt -name "*.lock" | xargs rm

cache:
  directories:
    - $HOME/.ivy2
    - $HOME/.sbt

dist: xenial

# Don't use slim or alpine images here - the SBT Wrapper runs a shell script which wouldn't always work then:
env:
  - COMPILE_IMAGE_TAG=8-jdk TEST_IMAGE_TAG=8-jdk
  - COMPILE_IMAGE_TAG=12-jdk TEST_IMAGE_TAG=12-jdk

# TODO: Use docker-compose:
install:
  - docker run --detach --env MINIO_ACCESS_KEY=Santa-Claus --env MINIO_SECRET_KEY="Ho ho ho" --name s3-test --publish 12345:9000 --rm minio/minio:RELEASE.2019-08-21T19-40-07Z --compat server /data
  - ./docker-sbtw $COMPILE_IMAGE_TAG +test:compile
  - docker stop s3-test

language: minimal

# Run the build in Docker to shield it from changes in the Travis environment:
services:
  - docker

script: ./docker-sbtw $TEST_IMAGE_TAG +test
